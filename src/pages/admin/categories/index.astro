---
import DashboardLayout from "../../../layouts/dashboardLayout.astro";

const data = await fetch("http://localhost:3000/categories");
const categories = await data.json();
---

<DashboardLayout>
  <section class="category-page">
    <!-- HEADER -->
    <div class="header">
      <h2>Category Mainan</h2>
      <a href="/admin/categories/create" class="btn-add">
        + Tambah Category
      </a>
    </div>

    <!-- GRID -->
    <div class="category-grid">
      {Array.isArray(categories) &&
        categories.map((cat: any) => (
          <div class="card">
            <div class="image">
              <!-- placeholder image -->
              <img
                src="https://via.placeholder.com/150"
                alt={cat.CATEGORY}
              />
            </div>

            <h3>{cat.CATEGORY}</h3>

            <div class="actions">
              <a
                href={`/admin/categories/edit/${cat.CATEGORY_ID}`}
                class="btn edit"
              >
                 Edit
              </a>

              <button
                class="btn delete"
                onclick={`deleteItem('${cat.CATEGORY_ID}')`}
              >
                 Hapus
              </button>
            </div>
          </div>
        ))}
    </div>
  </section>
</DashboardLayout>

<script is:inline>
async function deleteItem(id) {
  if (confirm("Apakah Anda yakin ingin menghapus category ini?")) {
    const res = await fetch(`http://localhost:3000/categories/${id}`, {
      method: "DELETE",
    });

    if (res.ok) {
      location.reload();
    } else {
      alert("Gagal menghapus kategori");
    }
  }
}
</script>

<style>
.category-page {
  padding: 24px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.header h2 {
  font-size: 24px;
  font-weight: 700;
  color: #b83280;
}

.btn-add {
  background: #c026d3;
  color: #fff;
  padding: 10px 18px;
  border-radius: 10px;
  text-decoration: none;
  font-weight: 600;
}

/* GRID */
.category-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
}

/* CARD */
.card {
  background: #ffd6d6;
  padding: 16px;
  border-radius: 18px;
  text-align: center;
}

.image {
  background: #fff;
  border-radius: 14px;
  padding: 10px;
}

.image img {
  width: 100%;
  height: 140px;
  object-fit: contain;
}

.card h3 {
  margin: 12px 0;
  font-weight: 600;
}

/* ACTIONS */
.actions {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.btn {
  padding: 6px 14px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

.btn.edit {
  background: #fff;
}

.btn.delete {
  background: #fff;
}
</style>
