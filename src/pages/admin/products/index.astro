---
import DashboardLayout from "../../../layouts/dashboardLayout.astro";

const res = await fetch("http://localhost:3000/products");
const json = await res.json();
const products = Array.isArray(json.data) ? json.data : [];
---

<DashboardLayout>
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold">List Produk (Kategori Mainan)</h2>
    <a
      href="/admin/products/create"
      class="px-4 py-2 bg-amber-700 text-white rounded"
    >
      + Produk Baru
    </a>
  </div>

  <table class="w-full border border-gray-300 text-sm">
    <thead class="bg-gray-200">
      <tr>
        <th class="border p-3">ID</th>
        <th class="border p-3">Nama Produk</th>
        <th class="border p-3">Kategori</th>
        <th class="border p-3">Harga</th>
        <th class="border p-3">Stok</th>
        <th class="border p-3">Aksi</th>
      </tr>
    </thead>

    <tbody>
      {products.map((prod: any) => (
        <tr class="hover:bg-gray-100">
          <td class="border p-3">{prod.PRODUCT_ID}</td>
          <td class="border p-3">{prod.PRODUCT_NAME}</td>
          <td class="border p-3">{prod.CATEGORY}</td>
          <td class="border p-3">
            Rp {Number(prod.PRICE).toLocaleString()}
          </td>
          <td class="border p-3">{prod.STOCK}</td>
          <td class="border p-3">
            <a
              href={`/admin/products/edit/${prod.PRODUCT_ID}`}
              class="text-blue-600 mr-3"
            >
              Edit
            </a>
            <button
              class="text-red-600"
              onclick={`deleteItem('${prod.PRODUCT_ID}')`}
            >
              Delete
            </button>
          </td>
        </tr>
      ))}
    </tbody>
  </table>
</DashboardLayout>

<script is:inline>
async function deleteItem(id) {
  if (!confirm("Yakin ingin menghapus produk ini?")) return;

  const res = await fetch(`http://localhost:3000/products/${id}`, {
    method: "DELETE",
  });

  if (res.ok) {
    alert("Produk berhasil dihapus");
    location.reload();
  } else {
    const data = await res.json();
    alert(data.message || "Gagal menghapus produk");
  }
}
</script>
